<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">

<dom-module id="k-publishing">
  <template>
    <style>
      paper-button {
        background: #2a9af2;
        color: white;
      }
    </style>

    <paper-button
      disabled="[[disabled]]"
      on-click="publish"
    >Publish</paper-button>

    <iron-ajax
     url="[[postUrl]]"
     content-type="application/json"
     body="{{computeBody(title, shortContent, content, category, image)}}"
     method="GET"
     on-response="ajaxResponse"
    ></iron-ajax>

  </template>

  <script>
   Polymer({
      is: 'k-publishing',
      properties: {
        redirectUrl: String,
        title: {
          type: String,
          value: 'A Post'
        },
        shortContent:{
          type: String,
          value: 'ShortContent'
        },
        content: {
          type: String,
          value: 'Content'
        },
        category: {
          type: String,
          value: 'Category1'
        },
        postUrl: String,
        image: {
          type: String,
          value: 'http://cat.com'
        },
        disabled: {
          type: String,
          notify: true
        }
      },
      computeBody: function(title, shortContent, content, category, image) {
        return { title: title, short_content: shortContent, content: content, category: category, image: image }
      },
      publish: function(e) {
        this.$$('iron-ajax').generateRequest();
      },
      ajaxResponse: function(e) {
        debugger
        this.fire('iron-signal', { name: 'finishpublishing', data: null });
        document.location = this.redirectUrl;
      }
    });
  </script>
</dom-module>
